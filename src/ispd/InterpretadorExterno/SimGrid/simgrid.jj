/*	Author: Victor Aoqui
	Last modified: 10/10/2010
	Universidade Estadual Paulista "Júlio de Mesquita Filho"
	Instituto de Biociências, Letras e Ciências Exatas
	Departamento de Ciências de Computação e Estatística
	Grupo de Sistemas Paralelos e Distribuídos
*/

PARSER_BEGIN(SimGrid)
	
	package InterpretadorExterno.SimGrid;
	import java.io.*;
	import java.lang.SecurityException;
	import java.util.Formatter;
	import java.util.FormatterClosedException;
	import java.util.NoSuchElementException;
	import java.util.List;
	import java.util.ArrayList;
	import java.util.Scanner;
	import java.awt.*;
	import javax.swing.*;

	public class SimGrid
	{
		private Formatter file;
		private static int net;
		private String arg;
		private static SimGrid parser;
		private static List<Server> servers = new ArrayList<Server>();
		private static List<Master> masters = new ArrayList<Master>();
		private static List<Network> networks = new ArrayList<Network>();
		private static List<Route> routes = new ArrayList<Route>();
		private static int contaErrosSint = 0;
		private static int contaErrosSem = 0;
		private static String errosSint = "Erros sintáticos:\n";
		private static String errosSem = "Erros semânticos:\n";
		private String erros = "";
		
		private static class Server
		{
			private String id;
			private String power;
			
			public Server()
			{
				id = "";
				power = "0.0";
			}

			public void setID(String id)
			{
				this.id = id;
			}
			
			public void setPower(String power)
			{
				this.power = power;
			}
	 
			public String getID()
			{
				return id;
			}
			
			public String getPower()
			{
				return power;
			}
		}
		
		private static class Master extends Server
		{
			private String numtarefas;
			private String maxcomp;
			private String mincomp;
			private String maxcomm;
			private String mincomm;
			private List<String> slaves;

			public Master()
			{
				numtarefas = "0";
				maxcomp = "0.0";
				mincomp = "0.0";
				maxcomm = "0.0";
				mincomm = "0.0";
				slaves = new ArrayList<String>();
			}
			
			public void setSlaves(List<String> slaves)
			{
				this.slaves = slaves;
			}

			public void setCarga(String numtarefas, String maxcomp, String mincomp, String maxcomm, String mincomm)
			{
				this.numtarefas = numtarefas;
				this.maxcomp = maxcomp;
				this.mincomp = mincomp;
				this.maxcomm = maxcomm;
				this.mincomm = mincomm;
			}

			public void setCarga(String numtarefas, String maxcomp, String maxcomm)
			{
				this.numtarefas = numtarefas;
				this.maxcomp = maxcomp;
				this.maxcomm = maxcomm;
			}

			public List<String> getEscravos()
			{
				return slaves;
			}

			public String getNumtarefas()
			{
				return numtarefas;
			}

			public String getMaxcomp()
			{
				return maxcomp;
			}

			public String getMincomp()
			{
				return mincomp;
			}

			public String getMaxcomm()
			{
				return maxcomm;
			}

			public String getMincomm()
			{
				return mincomm;
			}
		}

		private static class Network
		{
			private String id;
			private String band;
			private String latency;
			
			public Network()
			{
				id = "";
				band = "0.0";
				latency = "0.0";
			}
			
			public void setAtributos(String id, String band, String latency)
			{
				this.id = id;
				this.band = band;
				this.latency = latency;
			}

			public String getID()
			{
				return id;
			}

			public String getBand()
			{
				return band;
			}
			
			public String getLatency()
			{
				return latency;
			}
		}

		private static class Route extends Network
		{
			private int net;
			private String src;
			private String dst;

			public Route()
			{
				net = 0;
				src = "";
				dst = "";
			}
			
			public void setRoute(int net, String src, String dst)
			{
				this.net = net;
				this.src = src;
				this.dst = dst;
			}

			public int getNet()
			{
				return net;
			}
			
			public String getSrc()
			{
				return src;
			}
			
			public String getDst()
			{
				return dst;
			}
		}
		
		public static SimGrid getInstance(FileInputStream file)
		{
			if(parser == null)
				parser = new SimGrid(file);
			return parser;
		}
		
		public void closeFile()
		{
			if(file!=null)
				file.close();
		}
		
		public boolean resultadoParser()
		{			
			if(token_source.contaErrosLex() > 0 || contaErrosSint() > 0 || contaErrosSem() > 0)
			{
				addErro("Foram encontrados "+String.valueOf(token_source.contaErrosLex())+" erros léxicos.");
				addErro("Foram encontrados "+String.valueOf(contaErrosSint())+" erros sintáticos.");
				addErro("Foram encontrados "+String.valueOf(contaErrosSem())+" erros semânticos.");
				if(token_source.contaErrosLex() > 0)
					addErro(token_source.getErrosLex());
				if(contaErrosSint() > 0)
					addErro(getErrosSint());
				if(contaErrosSem() > 0)
					addErro(getErrosSem());
				MostraSaida saida = new MostraSaida("Erro!",getErros());
				saida.setVisible(true);
			}
			else
			{
				JOptionPane.showOptionDialog(null,"Modelo SimGrid reconhecido com sucesso.", "Modelo SimGrid reconhecido", JOptionPane.DEFAULT_OPTION, JOptionPane.PLAIN_MESSAGE, null, null, null);
				return false;
			}
			return true;
		}
		
		public void writefile() throws ParseException, TokenMgrError, IOException
		{
			List<String> escravos;
			try
			{
				File arquivo = new File("modeloiconico");
				file = new Formatter(arquivo);

				for(Master m:masters)
				{
					escravos = m.getEscravos();
					file.format("MAQ %s %s 0.0 MESTRE RoundRobin LMAQ", m.getID(), m.getPower());
					for(String e:escravos)
						file.format(" %s", e);
					file.format("\n");
				}
			
				for(Server s:servers)
					file.format("MAQ %s %s 0.0 ESCRAVO\n", s.getID(), s.getPower());
				
				for(Route r:routes)
					file.format("REDE %s[%d] %s %s 0.0 CONECTA %s %s\n", r.getID(), r.getNet(), r.getBand(), r.getLatency(), r.getSrc(), r.getDst());
				
				for(Master m:masters)
					file.format("CARGA MAQUINA %s %s %s %s %s %s", m.getID(), m.getNumtarefas(), m.getMaxcomp(), m.getMincomp(), m.getMaxcomm(), m.getMincomm());
				
				closeFile();
				//JOptionPane.showMessageDialog(null,"File successfully opened\n"+arquivo.getAbsolutePath(),"Completed",JOptionPane.INFORMATION_MESSAGE);
			}
			catch(Exception e)
			{
				JOptionPane.showMessageDialog(null,e.getMessage(),"Error",JOptionPane.WARNING_MESSAGE);
			}
		}
		
		
		public int contaErrosSint()
		{
			return contaErrosSint;
		}
		
		public int contaErrosSem()
		{
			return contaErrosSem;
		}
		
		public void addErro(String msg)
		{
			erros = erros + msg + "\n";
		}

		public static void addErroSint(String msg)
		{
			errosSint = errosSint + "\n" + msg;
			contaErrosSint++;
		}
		
		public static void addErroSem(String msg)
		{
			errosSem = errosSem + "\n" + msg;
			contaErrosSem++;
		}
		
		public String getErros()
		{
			return erros;
		}
		
		public String getErrosSint()
		{
			return errosSint+"\n";
		}
		
		public String getErrosSem()
		{
			return errosSem+"\n";
		}
		
		public void reset()
		{
			file = null;
			net = 0;
			arg = "";
			contaErrosSint = 0;
			contaErrosSem = 0;
			errosSint = "\nErros sintáticos:\n";
			errosSem = "\nErros semânticos:\n";
			erros = "";
			masters = new ArrayList<Master>();
			servers = new ArrayList<Server>();
			networks = new ArrayList<Network>();
			routes = new ArrayList<Route>();
			token_source.reset();
		}
	}
PARSER_END(SimGrid)

TOKEN_MGR_DECLS:
{
	private static int contaErrosLex = 0;
	private static String errosLex = "\nErros léxicos:\n";
	
	public static int contaErrosLex()
	{
		return contaErrosLex;
	}
	
	public static void addErroLex(String msg)
	{
		errosLex = errosLex + "\n" + msg;
		contaErrosLex++;
	}
	
	public static String getErrosLex()
	{
		return errosLex+"\n";
	}
	
	public static void reset()
	{
		contaErrosLex = 0;
		errosLex = "\nErros léxicos:\n";
	}
}

TOKEN:
{
	< XML: "xml" > |
	< CPU: "cpu" > |
	< NAME: "name" > |
	< BANDWIDTH: "bandwidth" > |
	< LATENCY: "latency" > |
	< ROUTE: "route" > |
	< SRC: "src" > |
	< DST: "dst" > |
	< ROUTE_ELEMENT: "route_element"> |
	< PROCESS: "process" > |
	< NETWORK_LINK: "network_link" > |
	< HOST: "host" > |
	< FUNCTION: "function" > |
	< ARGUMENT: "argument" > |
	< VALUE: "value" > |
	< POWER: "power" > |
	< MASTER: "master" > |
	< SLAVE: "slave" > |
	< TASKSOURCE: "tasksource" > |
	< SLAVECOMM: "slavecomm" > |
	< RELOADHOST: "reloadhost" > |
	< FORWARDERSCHEDULER: "forwarderscheduler" > |
	< FORWARDERNODE: "forwardernode" > |
	< FORWARDERCOMM: "forwardercomm" > |
	< PLATFORM_DESCRIPTION: "platform_description" > |
	< VERSION: "version" >
}

TOKEN: {< letra: (["A"-"Z","a"-"z"]) >}
TOKEN: {< digito: (["0"-"9"]) >}
TOKEN: {< ponto: "." >}
TOKEN: {< barra: "/" >}
TOKEN: {< exclamacao: "!" >}
TOKEN: {< interrogacao: "?" >}
TOKEN: {< menor: "<" >}
TOKEN: {< maior: ">" >}
TOKEN: {< igual: "=" >}
TOKEN: {< apostrofo: "'" >}
TOKEN: {< aspas: "\"" >}
TOKEN: {< especiais: "-" | "_" | "." | "!" | "@" | "#" | "$" | "%" | "&" | "(" | ")" | "+" | "=" | "{" | "}" | "[" | "]" | "~" | "^" | ";" | "," | "|" | ":" | "/" >}

SPECIAL_TOKEN:
{
	<invalido: (~["A"-"Z", "a"-"z", "0"-"9", "<", ">", "'", "\"", "!" , "@" , "#" , "$" , "%" , "&" , "(" , ")" , "-" , "_" , "+" , "=" , "{" , "}" , "[" , "]" , "~" , "^" , ";" , "." , "," , "|" , ":" , "\\" , "/", "\n" , " " , "\t" , "\b" , "\f" , "\r" ]) >
	{
		addErroLex(InterpretadorSimGrid.getFileName() + ": Erro na linha "+input_stream.getEndLine()+", coluna "+input_stream.getEndColumn()+". Caracter \""+image+"\" não é aceito.");
	}
}

SKIP: { " " | "\t" | "\n" | "\r" | "\f" }
SKIP:
{
  "<!": WithinComment
}

<WithinComment> SKIP:
{
  ">": DEFAULT
  | <~[]>
}

String inteiro():
{
	String t = "";
}
{
	try
	{
		(<digito> {t += token.image;})+ {return t;}
	}
	catch(ParseException e)
	{
		Token t1 = getToken(1);
		addErroSem(InterpretadorSimGrid.getFileName() + ": Erro na linha "+t1.endLine+", coluna "+t1.endColumn+". Valor atribuído inválido.");
	}
}

String real():
{
	String t1, t2;
}
{
	try
	{
		t1 = inteiro() <ponto> {t1 += token.image;} t2 = inteiro() {t1 += t2; return t1;}
	}
	catch(ParseException e)
	{
		Token t = getToken(1);
		addErroSem(InterpretadorSimGrid.getFileName() + ": Erro na linha "+t.endLine+", coluna "+t.endColumn+". Valor atribuído inválido.");
	}
}

String num_tarefas():
{
	String t;
}
{
	t = inteiro() {return t;}
}

String max_comp_tam_tarefa():
{
	String t;
}
{
	LOOKAHEAD(real()) t = real() {return t;} | LOOKAHEAD(inteiro()) t = inteiro() {t += ".0"; return t;}
}

String min_comp_tam_tarefa():
{
	String t;
}
{
	LOOKAHEAD(real()) t = real() {return t;} | LOOKAHEAD(inteiro()) t = inteiro() {t += ".0"; return t;}
}

String max_comm_tam_tarefa():
{
	String t;
}
{
	LOOKAHEAD(real()) t = real() {return t;} | LOOKAHEAD(inteiro()) t = inteiro() {t += ".0"; return t;}
}

String min_comm_tam_tarefa():
{
	String t;
}
{
	LOOKAHEAD(real()) t = real() {return t;} | LOOKAHEAD(inteiro()) t = inteiro() {t += ".0"; return t;}
}

String capacidade_processamento():
{
	String t;
}
{
	LOOKAHEAD(real()) t = real() {return t;} | LOOKAHEAD(inteiro()) t = inteiro() {t += ".0"; return t;}
}

String largura_banda():
{
	String t;
}
{
	LOOKAHEAD(real()) t = real() {return t;} | LOOKAHEAD(inteiro()) t = inteiro() {t += ".0"; return t;}
}

String latencia():
{
	String t;
}
{
	LOOKAHEAD(real()) t = real() {return t;} | LOOKAHEAD(inteiro()) t = inteiro() {t += ".0"; return t;}
}

String identificador():
{
	String t = "";
	Token t1;
	boolean erro = false;
}
{
	try
	{
		((<letra> {t1 = getToken(1); t += token.image;} | 
		<digito> {t1 = getToken(1); t += token.image; erro = true;} | 
		<especiais> {t1 = getToken(1); t += token.image; erro = true;} | 
		<ponto> {t1 = getToken(1); t += token.image; erro = true;} | 
		<barra> {t1 = getToken(1); t += token.image; erro = true;} | 
		<exclamacao> {t1 = getToken(1); t += token.image; erro = true;} | 
		<interrogacao> {t1 = getToken(1); t += token.image; erro = true;} | 
		<menor> {t1 = getToken(1); t += token.image; erro = true;} | 
		<maior> {t1 = getToken(1); t += token.image; erro = true;} | 
		<igual> {t1 = getToken(1); t += token.image; erro = true;} | 
		<apostrofo> {t1 = getToken(1); t += token.image; erro = true;})
		(<letra> {t1 = getToken(1); t += token.image;} | 
		<digito> {t1 = getToken(1); t += token.image;} | 
		<especiais> {t1 = getToken(1); t += token.image;} |
		<ponto> {t1 = getToken(1); t += token.image; erro = true;} | 
		<barra> {t1 = getToken(1); t += token.image; erro = true;} | 
		<exclamacao> {t1 = getToken(1); t += token.image; erro = true;} | 
		<interrogacao> {t1 = getToken(1); t += token.image; erro = true;} | 
		<menor> {t1 = getToken(1); t += token.image; erro = true;} | 
		<maior> {t1 = getToken(1); t += token.image; erro = true;} | 
		<igual> {t1 = getToken(1); t += token.image; erro = true;} | 
		<apostrofo> {t1 = getToken(1); t += token.image; erro = true;})*)
		{
			if(erro == true) 
			{
				token_source.addErroLex(InterpretadorSimGrid.getFileName() + ": Erro na linha "+t1.endLine+", coluna "+t1.endColumn+". Identificador " + t +" declarado incorretamente.");
			}
			return t;
		}
	}
	catch(ParseException e)
	{
		Token t2 = getToken(1);
		addErroSint(InterpretadorSimGrid.getFileName() + ": Erro sintático na linha "+t2.endLine+", coluna "+t2.endColumn+".");
	}
}

String servidor_ID():
{
	String t;
}
{
	t = identificador() {return t;}
}

String rede_ID():
{
	String t;
}
{
	t = identificador() {return t;}
}

void modelo():
{}
{
	xml_version() inicio_plataforma() (LOOKAHEAD(2) application_file() | plataform_file()) fim_plataforma()
}

void application_file():
{}
{
	(LOOKAHEAD(2) processos())+
}

void plataform_file():
{}
{
	(LOOKAHEAD(2) plataforma())+
}

void plataforma():
{}
{
	LOOKAHEAD(2) servidor() | LOOKAHEAD(2) rede() | LOOKAHEAD(2) roteamento()
}

void xml_version():
{}
{
	try
	{
		<menor> <interrogacao> <XML> <VERSION> <igual> <apostrofo> real() <apostrofo> <interrogacao> <maior>
	}
	catch(ParseException e)
	{
		Token t = getToken(1);
		addErroSint(InterpretadorSimGrid.getFileName() + ": Erro sintático na linha "+t.endLine+", coluna "+t.endColumn+".");
	}
}

void inicio_plataforma():
{}
{
	try
	{
		<menor> <PLATFORM_DESCRIPTION> <VERSION> <igual> <aspas> inteiro() <aspas> <maior>
	}
	catch(ParseException e)
	{
		Token t = getToken(1);
		addErroSint(InterpretadorSimGrid.getFileName() + ": Erro sintático na linha "+t.endLine+", coluna "+t.endColumn+".");
	}
}

void fim_plataforma():
{}
{
	try
	{
		<menor> <barra> <PLATFORM_DESCRIPTION> <maior>
	}
	catch(ParseException e)
	{
		Token t = getToken(1);
		addErroSint(InterpretadorSimGrid.getFileName() + ": Erro sintático na linha "+t.endLine+", coluna "+t.endColumn+".");
	}
}

void processos():
{}
{
	LOOKAHEAD(<menor> <PROCESS> <HOST> <igual> <aspas> servidor_ID() <aspas> <FUNCTION> <igual> <aspas> <MASTER>) master() |
	LOOKAHEAD(<menor> <PROCESS> <HOST> <igual> <aspas> servidor_ID() <aspas> <FUNCTION> <igual> <aspas> <SLAVE>) slave() |
	LOOKAHEAD(<menor> <PROCESS> <HOST> <igual> <aspas> servidor_ID() <aspas> <FUNCTION> <igual> <aspas> (<TASKSOURCE> | <SLAVECOMM> | <RELOADHOST> | < FORWARDERSCHEDULER> | <FORWARDERNODE> | <FORWARDERCOMM>)) outros()
}

void master():
{
	String t1, t2, t3, t4, t5, t6, t7;
	Master m = new Master();
	boolean found = false;
	List<String> slaves = new ArrayList<String>();
}
{
	try
	{
		<menor> <PROCESS> <HOST> <igual> <aspas>
		t1 = servidor_ID()
		{
			Token t = getToken(1);
			for(Master testem:masters)
				if(t1.equals(testem.getID()))
				{
					addErroSem(InterpretadorSimGrid.getFileName() + ": Erro na linha "+t.endLine+", coluna "+t.endColumn+". Servidor \""+t1+"\" já foi declarado.");
					found = true;
				}
		}
		<aspas> <FUNCTION> <igual> <aspas> <MASTER> <aspas> <maior>
		<menor> <ARGUMENT> <VALUE> <igual> <aspas> t2 = num_tarefas() <aspas> <barra> <maior>
		(LOOKAHEAD(<menor> <ARGUMENT> <VALUE> <igual> <aspas> max_comp_tam_tarefa() <aspas> <barra> <maior>
		<menor> <ARGUMENT> <VALUE> <igual> <aspas> min_comp_tam_tarefa() <aspas> <barra> <maior>
		<menor> <ARGUMENT> <VALUE> <igual> <aspas> max_comm_tam_tarefa() <aspas> <barra> <maior>
		<menor> <ARGUMENT> <VALUE> <igual> <aspas> min_comm_tam_tarefa() <aspas> <barra> <maior>)
		(<menor> <ARGUMENT> <VALUE> <igual> <aspas> t3 = max_comp_tam_tarefa() <aspas> <barra> <maior>
		<menor> <ARGUMENT> <VALUE> <igual> <aspas> t4 = min_comp_tam_tarefa() <aspas> <barra> <maior>
		<menor> <ARGUMENT> <VALUE> <igual> <aspas> t5 = max_comm_tam_tarefa() <aspas> <barra> <maior>
		<menor> <ARGUMENT> <VALUE> <igual> <aspas> t6 = min_comm_tam_tarefa() <aspas> <barra> <maior> {m.setCarga(t2, t3, t4, t5, t6);}) |
		(<menor> <ARGUMENT> <VALUE> <igual> <aspas> t3 = max_comp_tam_tarefa() <aspas> <barra> <maior>
		<menor> <ARGUMENT> <VALUE> <igual> <aspas> t4 = max_comm_tam_tarefa() <aspas> <barra> <maior> {m.setCarga(t2, t3, t4);}))
		(LOOKAHEAD(2) <menor> <ARGUMENT> <VALUE> <igual> <aspas> t7 = servidor_ID()
		{
			Token tt = getToken(1);
			if(slaves.contains(t7))
			{
				addErroSem(InterpretadorSimGrid.getFileName() + ": Erro na linha "+tt.endLine+", coluna "+tt.endColumn+". Servidor \""+t7+"\" já foi declarado.");
				found = true;
			}
			else
				slaves.add(t7);
		}
		<aspas> <barra> <maior>)+ <menor> <barra> <PROCESS> <maior>
		{	
			if(!found)
			{
				m.setID(t1);
				m.setSlaves(slaves);
				masters.add(m);
			}
		}
	}
	catch(ParseException e)
	{
		Token t = getToken(1);
		addErroSint(InterpretadorSimGrid.getFileName() + ": Erro sintático na linha "+t.endLine+", coluna "+t.endColumn+".");
	}
}

void slave():
{
	String t;
	boolean found = false;
	Server s = new Server();
}
{
	try
	{
		<menor> <PROCESS> <HOST> <igual> <aspas>
		t = servidor_ID()
		{
			Token t1 = getToken(1);
			for(Server testes:servers)
				if(t.equals(testes.getID()))
				{
					addErroSem(InterpretadorSimGrid.getFileName() + ": Erro na linha "+t1.endLine+", coluna "+t1.endColumn+". Servidor \""+t+"\" já foi declarado.");
					found = true;
				}
			if(found == false)
			{
				s.setID(t);
				servers.add(s);
			}
		}
		<aspas> <FUNCTION> <igual> <aspas> <SLAVE> <aspas> <barra> <maior>
	}
	catch(ParseException e)
	{
		Token t2 = getToken(1);
		addErroSint(InterpretadorSimGrid.getFileName() + ": Erro sintático na linha "+t2.endLine+", coluna "+t2.endColumn+".");
	}
}

void outros():
{}
{
	LOOKAHEAD(<menor> <PROCESS> <HOST> <igual> <aspas> servidor_ID() <aspas> <FUNCTION> <igual> <aspas> <TASKSOURCE>) tasksource() |
	LOOKAHEAD(<menor> <PROCESS> <HOST> <igual> <aspas> servidor_ID() <aspas> <FUNCTION> <igual> <aspas> <SLAVECOMM>) slavecomm() |
	LOOKAHEAD(<menor> <PROCESS> <HOST> <igual> <aspas> servidor_ID() <aspas> <FUNCTION> <igual> <aspas> <RELOADHOST>) reloadhost() |
	LOOKAHEAD(<menor> <PROCESS> <HOST> <igual> <aspas> servidor_ID() <aspas> <FUNCTION> <igual> <aspas> <FORWARDERSCHEDULER>) forwarderscheduler() |
	LOOKAHEAD(<menor> <PROCESS> <HOST> <igual> <aspas> servidor_ID() <aspas> <FUNCTION> <igual> <aspas> <FORWARDERNODE>) forwardernode() |
	LOOKAHEAD(<menor> <PROCESS> <HOST> <igual> <aspas> servidor_ID() <aspas> <FUNCTION> <igual> <aspas> <FORWARDERCOMM>) forwardercomm()
}

void servidor():
{
	String t1, t2;
	boolean found = false;
}
{
	try
	{
		<menor> <CPU> <NAME> <igual> <aspas>
		t1 = servidor_ID()
		{Token t = getToken(1);}
		<aspas> <POWER> <igual> <aspas> t2 = capacidade_processamento() <aspas> <barra> <maior>
		{
			for(Server s:servers)
				if(t1.equals(s.getID()))
				{
					s.setPower(t2);
					found = true;
				}
			if(!found)
				for(Master m:masters)
					if(t1.equals(m.getID()))
					{
						m.setPower(t2);
						found = true;
					}
			if(!found)
			{
				addErroSem(InterpretadorSimGrid.getFileName() + ": Erro na linha "+t.endLine+", coluna "+t.endColumn+". Servidor \""+t1+"\" não foi declarado.");
			}
		}
	}
	catch(ParseException e)
	{
		Token t3 = getToken(1);
		addErroSint(InterpretadorSimGrid.getFileName() + ": Erro sintático na linha "+t3.endLine+", coluna "+t3.endColumn+".");
	}
}

void rede():
{
	String t1, t2, t3;
	Network n = new Network();
	boolean found = false;
}
{
	try
	{
		<menor> <NETWORK_LINK> <NAME> <igual> <aspas>
		t1 = rede_ID()
		{Token t = getToken(1);}
		<aspas> <BANDWIDTH> <igual> <aspas>
		t2 = largura_banda()
		<aspas> <LATENCY> <igual> <aspas>
		t3 = latencia()
		<aspas> <barra> <maior>
		{
			for(Network testen:networks)
				if(t1.equals(testen.getID()))
				{
					addErroSem(InterpretadorSimGrid.getFileName() + ": Erro na linha "+t.endLine+", coluna "+t.endColumn+". Link \""+t1+"\" já foi declarado.");
					found = true;
				}
			if(!found)
			{
				n.setAtributos(t1, t2, t3);
				networks.add(n);
			}
		}
	}
	catch(ParseException e)
	{
		Token t4 = getToken(1);
		addErroSint(InterpretadorSimGrid.getFileName() + ": Erro sintático na linha "+t4.endLine+", coluna "+t4.endColumn+".");
	}
}

void roteamento():
{
	String t1, t2, t3;
	Route r = new Route();
	boolean found = false;
}
{
	try
	{
		<menor> <ROUTE> <SRC> <igual> <aspas>
		t1 = servidor_ID()
		{
			Token t = getToken(1);
			for(Server s:servers)
				if(t1.equals(s.getID()))
					found = true;
			if(!found)
				for(Master m:masters)
					if(t1.equals(m.getID()))
						found = true;
			if(!found)
			{
				addErroSem(InterpretadorSimGrid.getFileName() + ": Erro na linha "+t.endLine+", coluna "+t.endColumn+". Servidor \""+t1+"\" não foi declarado.");
			}
			found = false;
		}
		<aspas> <DST> <igual> <aspas>
		t2 = servidor_ID()
		{
			Token tt = getToken(1);
			for(Master m:masters)
				if(t2.equals(m.getID()))
					found = true;
			for(Server s:servers)
				if(t2.equals(s.getID()))
					found = true;
			if(!found)
			{
				addErroSem(InterpretadorSimGrid.getFileName() + ": Erro na linha "+tt.endLine+", coluna "+tt.endColumn+". Servidor \""+t2+"\" não foi declarado.");
			}
			found = false;
		}
		<aspas> <maior> <menor> <ROUTE_ELEMENT> <NAME> <igual> <aspas>
		t3 = rede_ID()
		{Token ttt = getToken(1);}
		<aspas> <barra> <maior> <menor> <barra> <ROUTE> <maior>
		{
			for(Network n:networks)
				if(t3.equals(n.getID()))
				{
					net++;
					r.setAtributos(t3, n.getBand(), n.getLatency());
					r.setRoute(net, t1, t2);
					routes.add(r);
					found = true;
				}
			if(!found)
			{
				addErroSem(InterpretadorSimGrid.getFileName() + ": Erro na linha "+ttt.endLine+", coluna "+ttt.endColumn+". Link \""+t3+"\" não foi declarado.");
			}
		}
	}
	catch(ParseException e)
	{
		Token t4 = getToken(1);
		addErroSint(InterpretadorSimGrid.getFileName() + ": Erro sintático na linha "+t4.endLine+", coluna "+t4.endColumn+".");
	}
}

void tasksource():
{}
{
	try
	{
		<menor> <PROCESS> <HOST> <igual> <aspas> servidor_ID() <aspas> <FUNCTION> <igual> <aspas> <TASKSOURCE> <aspas> <maior> <menor> <ARGUMENT> <VALUE> <igual> <aspas> inteiro() <aspas> <barra> <maior> <menor> <barra> <PROCESS> <maior>
	}	
	catch(ParseException e)
	{
		Token t = getToken(1);
		addErroSint(InterpretadorSimGrid.getFileName() + ": Erro sintático na linha "+t.endLine+", coluna "+t.endColumn+".");
	}
}

void slavecomm():
{}
{
	try
	{
		<menor> <PROCESS> <HOST> <igual> <aspas> servidor_ID() <aspas> <FUNCTION> <igual> <aspas> <SLAVECOMM> <aspas> <barra> <maior>
	}
	catch(ParseException e)
	{
		Token t = getToken(1);
		addErroSint(InterpretadorSimGrid.getFileName() + ": Erro sintático na linha "+t.endLine+", coluna "+t.endColumn+".");
	}
}

void reloadhost():
{}
{
	try
	{
		<menor> <PROCESS> <HOST> <igual> <aspas> servidor_ID() <aspas> <FUNCTION> <igual> <aspas> <RELOADHOST> <aspas> <barra> <maior>
	}
	catch(ParseException e)
	{
		Token t = getToken(1);
		addErroSint(InterpretadorSimGrid.getFileName() + ": Erro sintático na linha "+t.endLine+", coluna "+t.endColumn+".");
	}
}

void forwarderscheduler():
{}
{
	try
	{
		<menor> <PROCESS> <HOST> <igual> <aspas> servidor_ID() <aspas> <FUNCTION> <igual> <aspas> <FORWARDERSCHEDULER> <aspas> <maior> <menor> <ARGUMENT> <VALUE> <igual> <aspas> servidor_ID() <aspas> <barra> <maior> <menor> <barra> <PROCESS> <maior>
	}
	catch(ParseException e)
	{
		Token t = getToken(1);
		addErroSint(InterpretadorSimGrid.getFileName() + ": Erro sintático na linha "+t.endLine+", coluna "+t.endColumn+".");
	}
}

void forwardernode():
{}
{
	try
	{
		<menor> <PROCESS> <HOST> <igual> <aspas> servidor_ID() <aspas> <FUNCTION> <igual> <aspas> <FORWARDERNODE> <aspas> <maior> (LOOKAHEAD(2) <menor> <ARGUMENT> <VALUE> <igual> <aspas> servidor_ID() <aspas> <barra> <maior>)+ <menor> <barra> <PROCESS> <maior>
	}
	catch(ParseException e)
	{
		Token t = getToken(1);
		addErroSint(InterpretadorSimGrid.getFileName() + ": Erro sintático na linha "+t.endLine+", coluna "+t.endColumn+".");
	}
}

void forwardercomm():
{}
{
	try
	{
		<menor> <PROCESS> <HOST> <igual> <aspas> servidor_ID() <aspas> <FUNCTION> <igual> <aspas> <FORWARDERCOMM> <aspas> <maior> (LOOKAHEAD(2) <menor> <ARGUMENT> <VALUE> <igual> <aspas> servidor_ID() <aspas> <barra> <maior>)+ <menor> <barra> <PROCESS> <maior>
	}
	catch(ParseException e)
	{
		Token t = getToken(1);
		addErroSint(InterpretadorSimGrid.getFileName() + ": Erro sintático na linha "+t.endLine+", coluna "+t.endColumn+".");
	}
}